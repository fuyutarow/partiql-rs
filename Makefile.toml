[tasks.install-dev]
script = '''
brew install jq jo yj
brew install fuyutarow/tap/tests-make
brew install fuyutarow/tap/version-make
'''

[tasks."build:pq"]
command = "cargo"
args = ["build", "--bin", "pq", "--features", "cli"]

[tasks."build:js"]
script = '''
cd partiql-js
wasm-pack build --release
wasm-pack build
'''

[tasks.release]
command = "cargo"
args = ["build", "--release"]

[tasks."release:pq"]
command = "cargo"
args = ["build", "--bin", "pq", "--release", "--features", "cli"]

[tasks."release:js"]
script = '''
cd partiql-js
wasm-pack build --release
'''

[tasks.publish]
script = '''
makers publish:rs
makers publish:js
'''

[tasks."publish:rs"]
dependencies = ["release"]
script = '''
cargo publish
'''

[tasks."publish:js"]
dependencies = ["release:js"]
script = '''
cd partiql-js
wasm-pack publish --tag fuyutarow
'''

[tasks.test]
alias = "test:all"

[tasks."test:all"]
script = '''
makers test:lib
makers test:pq
'''

[tasks."test:lib"]
dependencies = ["build"]
command = "cargo"
args = ["test"]

[tasks."test:pq"]
dependencies = ["build:pq"]
script = '''
tests-make tests-make/index.toml
'''

[tasks."web:dev"]
script = '''
cd examples/next
npm run dev
'''

[tasks."web:prod"]
script = '''
cd examples/next
npm run up:partiql
npm run prod
'''

[tasks."test:web"]
script = '''
tests-make tests-make/web.toml
'''

[tasks.update-tap]
script = '''
cargo-distribute --tap ~/homebrew-tap/ --channel nightly --bin pq
'''

[tasks.up]
script = '''
git remote add upstream https://github.com/fuyutarow/partiql-rs
git fetch upstream
git merge upstream/alpha
'''

[tasks.version-up]
script = '''
version-make up -rz Cargo.toml
version-make set partiql-js/Cargo.toml -v $(version-make show Cargo.toml)
'''

[tasks.version-tag]
script = '''
git tag v$(version-make show Cargo.toml)
'''

[tasks.version-untag]
script = '''
git tag v$(version-make show Cargo.toml) -d
'''

[tasks.fix]
script = '''
cargo fix
'''

[tasks.generate-json]
dependencies = ["build"]
script = '''
alias pc="./target/debug/partiql-cli"
alias pq="./target/debug/pq"
for i in $(seq 1 18)
cat samples/q$i.env | pc from --to json | pq -S > samples/q$i.json
'''
